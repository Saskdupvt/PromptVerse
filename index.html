<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PromptVerse | Master AI Directory</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f8fafc; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .prompt-card:hover { transform: translateY(-5px); transition: 0.3s; border-color: #3b82f6; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <nav class="glass sticky top-0 z-50 p-4 mb-8">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500 cursor-pointer" onclick="showView('home')">
                PromptVerse
            </h1>
            <div id="navAuth">
                <button onclick="showView('auth')" class="bg-blue-600 hover:bg-blue-700 px-5 py-2 rounded-full text-sm font-semibold transition">Sign In</button>
            </div>
            <div id="navUser" class="hidden flex items-center gap-4">
                <span id="displayEmail" class="text-sm text-gray-400"></span>
                <button onclick="showView('profile')" class="bg-gray-700 hover:bg-gray-600 p-2 rounded-full">ðŸ‘¤</button>
                <button onclick="handleLogout()" class="text-red-400 text-sm hover:underline">Logout</button>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 pb-20">
        
        <section id="homeView">
            <div class="text-center mb-12">
                <h2 class="text-4xl md:text-6xl font-extrabold mb-4">The Best AI Prompts in One Place</h2>
                <p class="text-gray-400 max-w-2xl mx-auto">Explore high-quality prompts for Midjourney, ChatGPT, and Video AI tools.</p>
            </div>
            
            <div class="flex flex-wrap justify-center gap-4 mb-10">
                <button onclick="fetchPrompts('All')" class="bg-gray-800 px-4 py-2 rounded-lg hover:bg-blue-600 transition">All</button>
                <button onclick="fetchPrompts('ChatGPT')" class="bg-gray-800 px-4 py-2 rounded-lg hover:bg-blue-600 transition">ChatGPT</button>
                <button onclick="fetchPrompts('Midjourney')" class="bg-gray-800 px-4 py-2 rounded-lg hover:bg-blue-600 transition">Midjourney</button>
                <button onclick="fetchPrompts('Video AI')" class="bg-gray-800 px-4 py-2 rounded-lg hover:bg-blue-600 transition">Video AI</button>
            </div>

            <div id="promptGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <p class="text-center col-span-full text-gray-500">Loading prompts...</p>
            </div>
        </section>

        <section id="authView" class="hidden flex justify-center">
            <div class="glass p-8 rounded-2xl w-full max-w-md">
                <h2 id="authTitle" class="text-2xl font-bold mb-6 text-center">Login</h2>
                <form id="authForm" class="space-y-4">
                    <input type="email" id="authEmail" placeholder="Email" class="w-full p-3 rounded bg-gray-900 border border-gray-700 focus:border-blue-500 outline-none" required>
                    <input type="password" id="authPassword" placeholder="Password" class="w-full p-3 rounded bg-gray-900 border border-gray-700 focus:border-blue-500 outline-none" required>
                    <button type="submit" id="authBtn" class="w-full bg-blue-600 py-3 rounded-lg font-bold hover:bg-blue-700">Login</button>
                </form>
                <p class="mt-4 text-center text-sm text-gray-400">
                    <span id="toggleText">Don't have an account?</span> 
                    <button onclick="toggleAuth()" class="text-blue-400 hover:underline ml-1">Switch Mode</button>
                </p>
            </div>
        </section>

        <section id="profileView" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-1 glass p-6 rounded-2xl h-fit">
                    <h3 class="text-xl font-bold mb-4 text-blue-400">Share a New Prompt</h3>
                    <form id="promptForm" class="space-y-4">
                        <input type="text" id="pTitle" placeholder="Title (e.g. Classic Mustang AI)" class="w-full p-3 rounded bg-gray-900 border border-gray-700 outline-none" required>
                        <textarea id="pText" rows="5" placeholder="Paste prompt here..." class="w-full p-3 rounded bg-gray-900 border border-gray-700 outline-none" required></textarea>
                        <select id="pCategory" class="w-full p-3 rounded bg-gray-900 border border-gray-700 outline-none">
                            <option value="ChatGPT">ChatGPT</option>
                            <option value="Midjourney">Midjourney</option>
                            <option value="Video AI">Video AI</option>
                        </select>
                        <button type="submit" class="w-full bg-green-600 py-3 rounded-lg font-bold hover:bg-green-700 transition">Publish Prompt</button>
                    </form>
                </div>
                <div class="lg:col-span-2 glass p-6 rounded-2xl">
                    <h3 class="text-xl font-bold mb-4">Your Dashboard</h3>
                    <div id="userPrompts" class="space-y-4">
                        <p class="text-gray-500">Your uploaded prompts will appear here.</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script>
        // --- 1. CONFIGURATION ---
        const SUPABASE_URL = 'https://omflycicfddvrizdjzcf.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_l-rATJ_SjrkQS-R-BamB1g_cXtPYoCl';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        let isLoginMode = true;

        // --- 2. VIEW CONTROLLER ---
        function showView(viewName) {
            const views = ['homeView', 'authView', 'profileView'];
            views.forEach(v => document.getElementById(v).classList.add('hidden'));
            document.getElementById(viewName + 'View').classList.remove('hidden');
            if(viewName === 'home') fetchPrompts();
        }

        function toggleAuth() {
            isLoginMode = !isLoginMode;
            document.getElementById('authTitle').innerText = isLoginMode ? 'Login' : 'Register';
            document.getElementById('authBtn').innerText = isLoginMode ? 'Login' : 'Sign Up';
            document.getElementById('toggleText').innerText = isLoginMode ? "Don't have an account?" : "Already have an account?";
        }

        // --- 3. AUTHENTICATION ---
        document.getElementById('authForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;

            try {
                if (isLoginMode) {
                    const { data, error } = await _supabase.auth.signInWithPassword({ email, password });
                    if (error) throw error;
                    alert("Login Successful!");
                } else {
                    const { data, error } = await _supabase.auth.signUp({ email, password });
                    if (error) throw error;
                    alert("Registration Successful! Please login.");
                }
                checkUser();
                showView('home');
            } catch (err) {
                alert(err.message);
            }
        });

        async function handleLogout() {
            await _supabase.auth.signOut();
            checkUser();
            showView('home');
        }

        async function checkUser() {
            const { data: { user } } = await _supabase.auth.getUser();
            if (user) {
                document.getElementById('navAuth').classList.add('hidden');
                document.getElementById('navUser').classList.remove('hidden');
                document.getElementById('displayEmail').innerText = user.email;
            } else {
                document.getElementById('navAuth').classList.remove('hidden');
                document.getElementById('navUser').classList.add('hidden');
            }
        }

        // --- 4. DATABASE OPERATIONS ---
        async function fetchPrompts(category = 'All') {
            const grid = document.getElementById('promptGrid');
            grid.innerHTML = '<p class="text-center col-span-full">Loading...</p>';

            let query = _supabase.from('prompts').select('*').order('created_at', { ascending: false });
            if (category !== 'All') query = query.eq('category', category);

            const { data, error } = await query;

            if (error) {
                grid.innerHTML = `<p class="text-red-400">Error fetching data: ${error.message}</p>`;
                return;
            }

            grid.innerHTML = data.map(p => `
                <div class="glass p-5 rounded-2xl prompt-card border border-gray-800">
                    <div class="flex justify-between items-start mb-3">
                        <span class="text-xs font-bold px-2 py-1 bg-blue-900 text-blue-300 rounded uppercase">${p.category}</span>
                        <span class="text-xs text-gray-500">${new Date(p.created_at).toLocaleDateString()}</span>
                    </div>
                    <h4 class="text-lg font-bold mb-2">${p.title}</h4>
                    <p class="text-gray-400 text-sm mb-4 line-clamp-3 bg-black/30 p-3 rounded">${p.prompt_text}</p>
                    <button onclick="copyPrompt('${p.prompt_text.replace(/'/g, "\\'")}')" class="w-full py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm transition">Copy Prompt</button>
                </div>
            `).join('');
        }

        document.getElementById('promptForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const { data: { user } } = await _supabase.auth.getUser();
            
            const title = document.getElementById('pTitle').value;
            const text = document.getElementById('pText').value;
            const cat = document.getElementById('pCategory').value;

            const { error } = await _supabase.from('prompts').insert([
                { title: title, prompt_text: text, category: cat, user_id: user.id }
            ]);

            if (error) alert(error.message);
            else {
                alert("Published Successfully!");
                document.getElementById('promptForm').reset();
                showView('home');
            }
        });

        function copyPrompt(text) {
            navigator.clipboard.writeText(text);
            alert("Prompt copied to clipboard!");
        }

        // Initialize
        checkUser();
        fetchPrompts();
    </script>
</body>
</html>
